<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weather Checker | Wiz Utilities</title>
  <link rel="stylesheet" href="../style.css">
</head>
<body class="utility-page">
  <div class="utility-box">
    <a href="../dashboard.html" class="btn btn-back">â¬…ï¸ Back to Dashboard</a>
    <h1>â˜ï¸ Weather Checker</h1>

    <input type="text" id="city" placeholder="Enter city">
    <button class="btn-big" onclick="getWeather()">Check Weather</button>

    <div id="weatherResult" class="result-box"></div>
  </div>

<script>
async function getWeather() {
  const city = document.getElementById("city").value.trim();
  if(!city) return alert("Enter a city");

  try {
    // 1ï¸âƒ£ Get latitude/longitude using Open-Meteo geocoding
    const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1`);
    const geoData = await geoRes.json();

    if(!geoData.results || geoData.results.length === 0) return alert("City not found");

    const { latitude, longitude, name, country, timezone } = geoData.results[0];

    // 2ï¸âƒ£ Get current weather using Open-Meteo
    const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&timezone=${timezone}`);
    const weatherData = await weatherRes.json();

    const current = weatherData.current_weather;
    
    // 3ï¸âƒ£ Map weather code to description and emoji
    const weatherCodes = {
      0: "â˜€ï¸ Clear sky",
      1: "ğŸŒ¤ï¸ Mainly clear",
      2: "â›… Partly cloudy",
      3: "â˜ï¸ Overcast",
      45: "ğŸŒ«ï¸ Fog",
      48: "ğŸŒ«ï¸ Depositing rime fog",
      51: "ğŸŒ¦ï¸ Drizzle: Light",
      53: "ğŸŒ¦ï¸ Drizzle: Moderate",
      55: "ğŸŒ¦ï¸ Drizzle: Dense",
      56: "ğŸŒ§ï¸ Freezing Drizzle: Light",
      57: "ğŸŒ§ï¸ Freezing Drizzle: Dense",
      61: "ğŸŒ§ï¸ Rain: Slight",
      63: "ğŸŒ§ï¸ Rain: Moderate",
      65: "ğŸŒ§ï¸ Rain: Heavy",
      66: "ğŸŒ§ï¸ Freezing Rain: Light",
      67: "ğŸŒ§ï¸ Freezing Rain: Heavy",
      71: "â„ï¸ Snow: Slight",
      73: "â„ï¸ Snow: Moderate",
      75: "â„ï¸ Snow: Heavy",
      77: "â„ï¸ Snow grains",
      80: "ğŸŒ§ï¸ Rain showers: Slight",
      81: "ğŸŒ§ï¸ Rain showers: Moderate",
      82: "ğŸŒ§ï¸ Rain showers: Violent",
      85: "â„ï¸ Snow showers: Slight",
      86: "â„ï¸ Snow showers: Heavy",
      95: "ğŸŒ©ï¸ Thunderstorm: Slight/Moderate",
      96: "ğŸŒ©ï¸ Thunderstorm: Slight hail",
      99: "ğŸŒ©ï¸ Thunderstorm: Heavy hail"
    };

    const weatherDesc = weatherCodes[current.weathercode] || "â“ Unknown";

    // 4ï¸âƒ£ Convert UTC to local time
    const localTime = new Date(current.time).toLocaleString("en-US", { timeZone: timezone });

    // 5ï¸âƒ£ Display nicely
    document.getElementById("weatherResult").innerHTML = `
      <strong>${name}, ${country}</strong><br>
      ${weatherDesc}<br>
      ğŸŒ¡ï¸ Temp: ${current.temperature}Â°C<br>
      ğŸ’¨ Wind: ${current.windspeed} km/h<br>
      ğŸ•’ Local Time: ${localTime}
    `;

  } catch(e) {
    console.error(e);
    alert("Error fetching weather. Try again.");
  }
}
</script>
</body>
</html>
